#!/bin/bash

edit () {
    case $1 in
        scripts )
            nano ./project
            ;;

        * )
            nano ./HOOBS.code-workspace
            ;;
    esac
}

clone () {
    echo "cloning $1"

    case $1 in
        console )
            [[ -d console ]] || git clone https://github.com/hoobs-org/helm.git
            [[ -d console ]] || mv helm console
            (cd console && git checkout blackwing)
            ;;

        repo | security )
            [[ -d $1 ]] || git clone https://github.com/hoobs-org/$1.git
            ;;

        * )
            [[ -d $1 ]] || git clone https://github.com/hoobs-org/$1.git
            (cd $1 && git checkout blackwing)
            ;;
    esac
}

install () {
    echo "installing $1"

    (cd $1 && npm install)
}

push () {
    echo "pushing $1"

    (cd $1 && git push)
}

pull () {
    echo "pulling $1"

    (cd $1 && git pull && git checkout blackwing)
}

version () {
    case $1 in
        sdk | portal | console | network | pam | image )
            (cd $1 && ./project version $2)
            ;;
    esac
}

lint() {
    case $1 in
        sdk | portal | console | network )
            (cd $1 && ./project version $2)
            ;;
    esac
}

debug() {
    case $1 in
        portal | console )
            (cd $1 && ./project debug)
            ;;
    esac
}

build() {
    case $1 in
        localization )
            (cd lang && ./build)
            ;;

        sdk | portal | console | network | pam | image )
            (cd $1 && ./project build $2)
            ;;
    esac
}

rebuild() {
    case $1 in
        image )
            (cd $1 && ./project rebuild)
            ;;
    esac
}

publish() {
    case $1 in
        list )
            list $2
            ;;

        sdk | portal | console | network | pam )
            (cd $1 && ./project publish $2 $3)
            ;;
    esac
}

list () {
    case $1 in
        stable | edge | bleeding )
            reprepro -b ./repo/debian list $1
            ;;

        * )
            reprepro -b ./repo/debian list stable
            reprepro -b ./repo/debian list edge
            reprepro -b ./repo/debian list bleeding
            ;;
    esac
}

clean() {
    case $1 in
        sdk | portal | console | network | pam | image )
            (cd $1 && ./project clean)
            ;;
    esac 
}

case $1 in
    edit )
        edit $2
        ;;

    setup )
        clone cli
        clone console
        clone desktop
        clone gui
        clone hoobsd
        clone image
        clone network
        clone pam
        clone portal
        clone repo
        clone sdk
        clone security

        install cli
        install console
        install desktop
        install gui
        install hoobsd
        install network
        install pam
        install portal
        install sdk
        ;;

    push )
        push cli
        push console
        push desktop
        push gui
        push hoobsd
        push image
        push network
        push pam
        push portal
        push repo
        push sdk
        push security
        ;;

    pull )
        pull cli
        pull console
        pull desktop
        pull gui
        pull hoobsd
        pull image
        pull network
        pull pam
        pull portal
        pull repo
        pull sdk
        pull security

        install cli
        install console
        install desktop
        install gui
        install hoobsd
        install network
        install pam
        install portal
        install sdk
        ;;

    version )
        version $2 $3
        ;;

    lint )
        lint $2
        ;;

    debug )
        debug $2
        ;;

    build )
        build $2 $3
        ;;

    rebuild )
        rebuild $2
        ;;

    publish )
        publish $2 $3 $4
        ;;

    clean )
        clean $2
        ;;
esac
